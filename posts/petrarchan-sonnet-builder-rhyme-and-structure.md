---
title: "בונה סונטות פטררקיות: פתחו את סוד המבנה והחריזה"
english_slug: petrarchan-sonnet-builder-rhyme-and-structure
category: "מדעי הרוח / ספרות וכתיבה"
tags:
  - סונטה
  - שירה
  - חריזה
  - מבנה שיר
  - ספרות איטלקית
  - פטררקה
---
# בונה סונטות פטררקיות: פתחו את סוד המבנה והחריזה

האם צורה שירית עם חוקים נוקשים יכולה דווקא להצית יצירתיות? האם מגבלות הן כבלים או פתח לביטוי חדשני? הצטרפו למסע אל ליבת הסונטה הפטררקית – צורה קלאסית אלגנטית ששבתה את לבם של משוררים במשך דורות. כאן, תוכלו לבנות בעצמכם את שלד המבנה שלה ולפענח את קסם החריזה המדויקת.

<div class="sonnet-builder-app">
    <div class="app-header">
        <h2>בנו את מבנה הסונטה הפטררקית</h2>
        <p>בחרו את אות החריזה המתאימה לכל שורה. נסו לבנות את המבנה הקלאסי בעצמכם!</p>
    </div>
    <div class="sonnet-structure">
        <div class="octave" data-section="octave">
            <h3>אוקטבה (שורות 1-8)</h3>
            <div class="section-description">מציגה רעיון, שאלה או בעיה.</div>
            <div class="lines">
                <div class="line" data-line="1">
                    <span class="line-num">1.</span>
                    <select class="rhyme-letter">
                        <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                    <span class="selected-letter">?</span>
                </div>
                <div class="line" data-line="2">
                    <span class="line-num">2.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="3">
                    <span class="line-num">3.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="Eר</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="4">
                    <span class="line-num">4.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="5">
                    <span class="line-num">5.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="6">
                    <span class="line-num">6.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="7">
                    <span class="line-num">7.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="8">
                    <span class="line-num">8.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
            </div>
        </div>
        <div class="sestet" data-section="sestet">
             <h3>ססטט (שורות 9-14)</h3>
             <div class="section-description">מציג פתרון, תפנית או פרשנות (ה'וולטה' לרוב בשורה 9).</div>
             <div class="lines">
                <div class="line" data-line="9">
                    <span class="line-num">9.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="10">
                    <span class="line-num">10.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="11">
                    <span class="line-num">11.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="12">
                    <span class="line-num">12.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="13">
                    <span class="line-num">13.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
                 <div class="line" data-line="14">
                    <span class="line-num">14.</span>
                     <select class="rhyme-letter">
                         <option value="">?</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                     <span class="selected-letter">?</span>
                </div>
            </div>
        </div>
    </div>
    <button id="checkStructureBtn">בדקו את המבנה שבניתם</button>
    <div id="result" class="result"></div>
</div>

<style>
/* General App Styling */
.sonnet-builder-app {
    font-family: 'Varela Round', sans-serif; /* Use a friendlier font */
    max-width: 600px;
    margin: 30px auto; /* More margin */
    padding: 25px; /* More padding */
    border: none; /* Remove default border */
    border-radius: 12px; /* More rounded corners */
    background: linear-gradient(to bottom right, #e0f7fa, #b2ebf2); /* Subtle gradient background */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); /* Softer, larger shadow */
    direction: rtl;
    text-align: right;
    overflow: hidden; /* Clear floats */
}

.app-header {
    text-align: center;
    margin-bottom: 25px;
}

.sonnet-builder-app h2 {
    color: #004d40; /* Dark teal */
    margin-bottom: 8px;
    font-size: 1.8em;
}

.sonnet-builder-app h3 {
    color: #00796b; /* Slightly lighter teal */
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.4em;
}

.sonnet-builder-app p {
    color: #263238; /* Dark grey text */
    font-size: 1.1em;
    line-height: 1.6;
}

/* Structure Sections (Octave/Sestet) */
.sonnet-structure {
    display: flex;
    flex-direction: column;
    gap: 25px; /* Increased gap */
}

.octave, .sestet {
    border: none; /* Remove section borders */
    border-radius: 10px;
    padding: 20px; /* More padding */
    background-color: #ffffff; /* White background for sections */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08); /* Subtle section shadow */
    transition: transform 0.3s ease; /* Add hover effect */
}

.octave:hover, .sestet:hover {
    transform: translateY(-3px); /* Lift effect on hover */
}

.octave {
    border-top: 5px solid #007bff; /* Blue accent */
}

.sestet {
    border-top: 5px solid #28a745; /* Green accent */
}

.section-description {
    font-size: 0.9em;
    color: #546e7a; /* Muted grey */
    margin-bottom: 15px;
    text-align: center;
}


/* Individual Lines */
.lines {
    display: flex;
    flex-direction: column;
    gap: 12px; /* Increased gap */
}

.line {
    display: flex;
    align-items: center;
    gap: 15px; /* Increased gap */
    padding: 8px 0; /* Add some vertical padding */
    border-bottom: 1px dashed #cfd8dc; /* Subtle separator */
    transition: background-color 0.3s ease; /* Hover transition */
}

.line:last-child {
    border-bottom: none; /* No border for the last line */
}

.line:hover {
     background-color: #e0f2f7; /* Light hover background */
}

.line-num {
    font-weight: bold;
    width: 25px; /* Slightly wider */
    text-align: left;
    color: #004d40; /* Match header color */
    flex-shrink: 0; /* Prevent shrinking */
}

.rhyme-letter {
    padding: 6px 8px; /* More padding */
    border-radius: 5px; /* More rounded */
    border: 1px solid #b0bec5; /* Muted border color */
    background-color: #ffffff;
    cursor: pointer;
    font-size: 1em;
    color: #37474f; /* Darker text */
    flex-grow: 0; /* Don't grow */
    flex-shrink: 0; /* Don't shrink */
    min-width: 50px; /* Ensure minimum width */
    -webkit-appearance: none; /* Remove default dropdown arrow */
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.362%22%20height%3D%22292.362%22%3E%3Cpath%20fill%3D%22%23607D8B%22%20d%3D%22M287.944%20114.234H4.418c-6.627%200-9.94%207.931-5.23%2012.64l139.267%20139.267c4.709%204.709%2012.31%204.709%2017.02%200L293.174%20126.874c4.71-4.71%201.396-12.64-5.23-12.64z%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: left 10px center; /* Adjust arrow position */
    background-size: 12px; /* Adjust arrow size */
    padding-left: 30px; /* Make space for arrow */
    text-align: right; /* Adjust text alignment */
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.rhyme-letter:focus {
    outline: none;
    border-color: #00796b;
    box-shadow: 0 0 5px rgba(0, 121, 107, 0.3);
}


.selected-letter {
    font-weight: bold;
    min-width: 1.2em; /* Ensure space */
    text-align: center;
    color: #004d40; /* Match header color */
    font-size: 1.2em;
    animation: fadeIn 0.3s ease; /* Add fade-in animation */
    flex-grow: 1; /* Allow it to take space */
    text-align: left; /* Align selected letter to the left */
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}


/* Button Styling */
#checkStructureBtn, #toggleExplanationBtn {
    display: block;
    width: 100%;
    padding: 12px 20px; /* More padding */
    margin-top: 25px; /* More margin */
    border: none;
    border-radius: 8px; /* More rounded */
    font-size: 1.2em; /* Larger font */
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s ease;
    text-align: center;
    font-family: 'Varela Round', sans-serif;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

#checkStructureBtn {
    background-color: #007bff; /* Blue */
    color: white;
}

#checkStructureBtn:hover {
    background-color: #0069d9; /* Darker blue */
    transform: translateY(-2px);
}
#checkStructureBtn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#toggleExplanationBtn {
    background-color: #607d8b; /* Muted grey */
    color: white;
    margin-top: 15px; /* Less margin between app and toggle */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

#toggleExplanationBtn:hover {
    background-color: #546e7a; /* Darker grey */
    transform: translateY(-2px);
}
#toggleExplanationBtn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}


/* Result Display */
.result {
    margin-top: 20px; /* More margin */
    padding: 15px; /* More padding */
    border-radius: 8px; /* More rounded */
    min-height: 1.5em;
    text-align: center;
    font-weight: bold;
    font-size: 1.1em;
    opacity: 0; /* Start hidden */
    transform: translateY(10px); /* Start slightly down */
    animation: slideInResult 0.5s ease forwards; /* Animation */
}

@keyframes slideInResult {
    to { opacity: 1; transform: translateY(0); }
}


.result.success {
    background-color: #e8f5e9; /* Light green */
    color: #1b5e20; /* Dark green */
    border: 1px solid #a5d6a7; /* Green border */
}

.result.error {
    background-color: #ffebee; /* Light red */
    color: #b71c1c; /* Dark red */
    border: 1px solid #ef9a9a; /* Red border */
}

/* Error/Success Line/Section Highlights (Added by JS) */
.line.incorrect {
    background-color: #ffcdd2; /* Light red background */
    border-color: #ef9a9a; /* Red border */
}
.line.correct {
    background-color: #c8e6c9; /* Light green background */
    border-color: #a5d6a7; /* Green border */
}
.octave.incorrect, .sestet.incorrect {
    border-color: #e57373; /* Red accent border */
}
.octave.correct, .sestet.correct {
     border-color: #81c784; /* Green accent border */
}


/* Explanation Section */
.explanation {
    margin-top: 20px;
    padding: 25px;
    border: none; /* Remove default border */
    border-radius: 12px;
    background-color: #e1f5fe; /* Light blue background */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    direction: rtl;
    text-align: right;
    display: none; /* Initially hidden */
    /* Smooth toggle using max-height and opacity */
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.7s ease-in-out, opacity 0.7s ease-in-out, padding 0.7s ease-in-out;
}

.explanation.visible {
    display: block;
    max-height: 1500px; /* Needs to be larger than max possible height */
    opacity: 1;
    padding: 25px;
}


.explanation h2 {
    color: #01579b; /* Darker blue */
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.6em;
    text-align: center;
}
.explanation h3 {
    color: #0277bd; /* Medium blue */
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.3em;
    text-align: right;
}

.explanation p, .explanation ul {
    line-height: 1.7; /* More space between lines */
    color: #263238;
    font-size: 1em;
    margin-bottom: 15px;
}

.explanation ul {
    padding-right: 30px; /* More indentation */
    list-style: disc inside; /* Use discs */
}

.explanation li {
    margin-bottom: 8px;
}


/* Responsive adjustments */
@media (max-width: 480px) {
    .sonnet-builder-app {
        padding: 15px;
    }
    .line {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
     .line-num {
        width: auto;
        margin-bottom: 5px;
     }
     .rhyme-letter {
         width: 100%; /* Full width on small screens */
         box-sizing: border-box; /* Include padding and border in width */
         text-align: left; /* Align text left in dropdown */
         padding-right: 30px; /* Adjust padding */
         background-position: left 10px center;
     }
     .selected-letter {
        min-width: auto;
        text-align: right; /* Align displayed letter right */
     }
    #checkStructureBtn, #toggleExplanationBtn {
        font-size: 1em;
        padding: 10px 15px;
    }
}

</style>

<button id="toggleExplanationBtn">רוצים לדעת יותר? קראו על מבנה הסונטה</button>

<div id="explanation" class="explanation">
    <h2>צוללים פנימה: מבנה הסונטה הפטררקית והקסם שמאחוריו</h2>
    <p>הסונטה היא לא סתם שיר קצר בן 14 שורות – היא מבנה ארכיטקטוני ספרותי מדויק, המאפשר למשורר לבנות רעיון מורכב בשלבים. הסונטה האיטלקית, שנקראת על שם המשורר פטררקה שהשתמש בה רבות והפך אותה לפופולרית, היא דוגמה מופלאה לכך. שמה, "sonetto", משמעותו "צליל קטן" באיטלקית – כיאה ליצירה תמציתית ומלודית.</p>

    <h3>פטררקה מול שייקספיר: ההבדל טמון במבנה</h3>
    <p>בעוד שהסונטה האנגלית (השייקספירית) מחולקת לשלושה בתים של ארבע שורות כל אחד ובית סיום בן שתי שורות (ABAB CDCD EFEF GG), הסונטה הפטררקית מאורגנת אחרת לגמרי, וחלוקה זו משפיעה עמוקות על התפתחות הרעיון בשיר:</p>
    <ul>
        <li>**האוקטבה (Octave):** 8 השורות הראשונות. זהו החלק ה"תֵזָה" של השיר. לרוב, האוקטבה מציגה מצב, שאלה, בעיה, תמונה או רעיון ראשוני. סכמת החריזה שלה כמעט תמיד אחידה וסימטרית: **ABBAABBA**. זה יוצר זרימה מלוכדת, כמעט כמו גל שעולה ויורד.</li>
        <li>**הססטט (Sestet):** 6 השורות האחרונות. זהו החלק ה"אַנְטִיתֵזָה" או ה"סינתזה". כאן מגיע השינוי, התשובה, הפרשנות, הפתרון או ההשלכה של מה שהוצג באוקטבה. הססטט גמיש יותר מבחינת חריזה, אך יש לו כלל חשוב: הוא **לעולם לא ישתמש באותיות החריזה מהאוקטבה (A או B)**. הוא מציג שתיים או שלוש אותיות חריזה חדשות (לרוב C, D, E), בסכמות כמו CDECDE, CDCDCD, CDEDCE, CDEEDC, CDDCDE ועוד.</li>
    </ul>

    <h3>ה'וולטה' (Volta): נקודת המפנה המרכזית</h3>
    <p>המעבר בין האוקטבה לססטט, לרוב בין שורה 8 לשורה 9, הוא המקום שבו מתרחשת ה'וולטה' (באיטלקית: "פנייה", "תפנית"). זהו הרגע הדרמטי או הרעיוני המרכזי בשיר. השיר "פונה" לכיוון חדש – מהכלל אל הפרט, מהתיאור אל הפרשנות, מהשאלה אל התשובה, מהעבר אל ההווה. הוולטה היא מה שהופך את הסונטה הפטררקית ליותר מאוסף שורות חורזות; היא יוצרת מבנה דיאלקטי, דו-שיח בין שני חלקי השיר.</p>

    <h3>מדוע המבנה חשוב?</h3>
    <p>הנוקשות של האוקטבה מול הגמישות היחסית של הססטט, בשילוב עם חוקי החריזה והוולטה, אינם שרירותיים. הם כופים על המשורר לחשוב בצורה מרוכזת ומובנית. עליו להציג את הרעיון המרכזי בצורה ברורה בשמונה שורות, ואז למצוא דרך מקורית לפתח או לשנות אותו בשש השורות הנותרות, תוך שימוש בצלילים חרוזים חדשים. המבנה הופך לכלי חשיבה וכלי ביטוי, שמאתגר את המשורר ויוצר אצל הקורא חוויית קריאה של בנייה והתרה רעיונית.</p>
    <p>כעת, לאחר שהבנתם את הכללים, נסו שוב לבנות את המבנה הנכון בעצמכם!</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const rhymeSelects = document.querySelectorAll('.rhyme-letter');
    const checkButton = document.getElementById('checkStructureBtn');
    const resultDiv = document.getElementById('result');
    const explanationDiv = document.getElementById('explanation');
    const toggleExplanationBtn = document.getElementById('toggleExplanationBtn');
    const lines = document.querySelectorAll('.line');
    const octaveDiv = document.querySelector('.octave');
    const sestetDiv = document.querySelector('.sestet');

    // Function to update selected letter display and trigger animation
    const updateSelectedLetter = (selectElement) => {
        const selectedLetterSpan = selectElement.closest('.line').querySelector('.selected-letter');
        selectedLetterSpan.textContent = selectElement.value === '' ? '?' : selectElement.value;
        // Simple animation reset by removing and re-adding class
        selectedLetterSpan.classList.remove('animate');
        void selectedLetterSpan.offsetWidth; // Trigger reflow
        selectedLetterSpan.classList.add('animate');
    };

     // Function to clear all result/error highlights
    const clearHighlights = () => {
        lines.forEach(line => {
            line.classList.remove('correct', 'incorrect');
        });
        octaveDiv.classList.remove('correct', 'incorrect');
        sestetDiv.classList.remove('correct', 'incorrect');
        resultDiv.style.opacity = 0; // Hide result initially
        resultDiv.classList.remove('success', 'error');
    };


    // Update selected letter display on change and clear previous results
    rhymeSelects.forEach((select) => {
        select.addEventListener('change', () => {
            updateSelectedLetter(select);
            clearHighlights(); // Clear results when user changes input
            resultDiv.textContent = ''; // Clear result text
        });
         // Initialize display on load
         updateSelectedLetter(select);
    });

    // Check structure on button click
    checkButton.addEventListener('click', () => {
        clearHighlights(); // Clear highlights before checking again

        const selectedRhymeLetters = Array.from(rhymeSelects).map(select => select.value);

        // Basic validation: check if all lines have a letter selected
        if (selectedRhymeLetters.includes('')) {
             resultDiv.textContent = 'אופס! יש לבחור אות חריזה לכל 14 השורות לפני הבדיקה.';
             resultDiv.className = 'result error';
             resultDiv.style.opacity = 1; // Show result
             resultDiv.style.transform = 'translateY(0)';
             return;
        }

        const octaveLetters = selectedRhymeLetters.slice(0, 8);
        const sestetLetters = selectedRhymeLetters.slice(8);

        let isOctaveStructureValid = false;
        let isSestetStructureValid = false;
        let sestetUsesOctaveLetters = false;

        // --- Check Octave (must be ABBAABBA relative to the chosen letters) ---
        if (octaveLetters.length === 8) {
            const a = octaveLetters[0];
            const b = octaveLetters[1];

            // Check the ABBAABBA pattern and ensure A and B are different letters
            if (a !== b &&
                octaveLetters[0] === a && octaveLetters[1] === b &&
                octaveLetters[2] === b && octaveLetters[3] === a &&
                octaveLetters[4] === a && octaveLetters[5] === b &&
                octaveLetters[6] === b && octaveLetters[7] === a) {
                isOctaveStructureValid = true;
            }
        }

        // --- Check Sestet ---
        if (sestetLetters.length === 6) {
             const octaveUsedLetters = new Set(octaveLetters);

             // Check if Sestet uses Octave letters
             sestetLetters.forEach(letter => {
                 if (octaveUsedLetters.has(letter)) {
                     sestetUsesOctaveLetters = true;
                 }
             });

             // If Sestet uses Octave letters, it's invalid according to the strict rule
             if (sestetUsesOctaveLetters) {
                 isSestetStructureValid = false; // Sestet is invalid due to letter reuse
             } else {
                 // Map sestet letters relative to the *first* new letters encountered
                 const sestetLetterMap = {};
                 let nextSestetLetterChar = 'C';
                 const mappedSestet = sestetLetters.map(letter => {
                     if (!sestetLetterMap[letter]) {
                          sestetLetterMap[letter] = nextSestetLetterChar;
                          nextSestetLetterChar = String.fromCharCode(nextSestetLetterChar.charCodeAt(0) + 1);
                     }
                     return sestetLetterMap[letter];
                 }).join('');

                 const uniqueSestetMappedLetters = new Set(mappedSestet.split(''));
                 const numUniqueSestetLetters = uniqueSestetMappedLetters.size;

                 // Check common sestet patterns OR any valid combination of 2 or 3 NEW letters
                 const commonSestetPatterns = ['CDECDE', 'CDCDCD', 'CDEDCE', 'CDEEDC', 'CDDCDE', 'CCDDED', 'CDECED', 'CDDCEE']; // Added a few more common ones
                 if (commonSestetPatterns.includes(mappedSestet) && numUniqueSestetLetters >= 2 && numUniqueSestetLetters <=3) {
                     isSestetStructureValid = true;
                 } else if (numUniqueSestetLetters >= 2 && numUniqueSestetLetters <= 3) {
                     // If not a common pattern, but uses 2 or 3 *new* letters, consider it valid as per flexibility
                     isSestetStructureValid = true;
                 } else {
                      isSestetStructureValid = false; // Not 2 or 3 unique letters
                 }
             }
        }

        // --- Provide Feedback and Highlights ---
        let feedbackText = '';
        let isOverallCorrect = false;

        if (isOctaveStructureValid && isSestetStructureValid) {
            feedbackText = 'בראבו! המבנה שבנית תקין עבור סונטה פטררקית קלאסית. הבנת את סוד החלוקה והחריזה!';
            resultDiv.className = 'result success';
            octaveDiv.classList.add('correct');
            sestetDiv.classList.add('correct');
            isOverallCorrect = true;
        } else {
            feedbackText = 'המבנה שבנית דורש תיקון: ';
            resultDiv.className = 'result error';

            if (!isOctaveStructureValid) {
                 octaveDiv.classList.add('incorrect');
                 const a = octaveLetters[0];
                 const b = octaveLetters[1];
                 if (a === b) {
                      feedbackText += ` האותיות הראשונות באוקטבה (שורות 1 ו-2) חייבות להיות שונות. הן מגדירות את צלילי ה-A וה-B של האוקטבה.`;
                 } else {
                     feedbackText += ` האוקטבה (שורות 1-8) צריכה להיות במבנה ABBAABBA. אם בחרת ${a} ו-${b} עבור החרוזים הראשונים, המבנה צריך להיות ${a}${b}${b}${a}${a}${b}${b}${a}.`;
                 }
            } else {
                 octaveDiv.classList.add('correct'); // Octave is correct if structure passed
            }

            if (!isSestetStructureValid) {
                 sestetDiv.classList.add('incorrect');
                 if (!isOctaveStructureValid) feedbackText += ' וגם '; // Add "and also" if octave is also wrong

                 if (sestetUsesOctaveLetters) {
                      feedbackText += ' הססטט (שורות 9-14) לא יכול להשתמש באותיות החריזה של האוקטבה (במקרה זה, אותיות ' + Array.from(new Set(octaveLetters)).join(', ') + '). השתמש באותיות חריזה חדשות.';
                 } else {
                      const sestetUniqueCount = new Set(sestetLetters).size; // Count *actual* unique sestet letters
                      feedbackText += ` הססטט (שורות 9-14) צריך להשתמש ב-2 או 3 אותיות חריזה *חדשות* (שלא הופיעו באוקטבה) באחת מהסכמות המקובלות (לדוגמה: CDECDE, CDCDCD ועוד). המבנה שבנית משתמש ב-${sestetUniqueCount} אותיות חריזה שונות, או שאינו באחת הסכמות הנפוצות.`;
                 }
            } else {
                sestetDiv.classList.add('correct'); // Sestet is correct if structure passed
            }
        }

        resultDiv.textContent = feedbackText;
        resultDiv.style.opacity = 1; // Show result
        resultDiv.style.transform = 'translateY(0)';

        // Optional: highlight specific incorrect lines if Octave/Sestet is wrong
        if (!isOverallCorrect) {
             if (!isOctaveStructureValid) {
                  // Mark lines that break the ABBAABBA pattern
                  const a = octaveLetters[0];
                  const b = octaveLetters[1];
                   const expectedOctave = [a, b, b, a, a, b, b, a];
                  octaveLetters.forEach((letter, index) => {
                       if (letter !== expectedOctave[index]) {
                            lines[index].classList.add('incorrect');
                       } else if (a !== b) { // Only mark as correct if basic A/B difference holds
                           lines[index].classList.add('correct');
                       }
                  });
                  if(a===b) { // If A and B were the same, mark all octave lines incorrect
                       lines.forEach((line, index) => { if(index < 8) line.classList.add('incorrect'); });
                  }

             }
             if (!isSestetStructureValid) {
                 // Mark sestet lines. Simpler: just mark all sestet lines incorrect if the sestet section failed
                 sestetLetters.forEach((letter, index) => {
                      lines[index + 8].classList.add('incorrect');
                 });
             }
              // If one section is correct but the other isn't, mark correct lines in the correct section
             if (isOctaveStructureValid && !isSestetStructureValid) {
                  lines.forEach((line, index) => { if(index < 8) line.classList.add('correct'); });
             }
             if (!isOctaveStructureValid && isSestetStructureValid) {
                  lines.forEach((line, index) => { if(index >= 8) line.classList.add('correct'); });
             }
        }
    });

    // Toggle explanation visibility with transition
    toggleExplanationBtn.addEventListener('click', () => {
        const isVisible = explanationDiv.classList.contains('visible');
        if (isVisible) {
            explanationDiv.classList.remove('visible');
            toggleExplanationBtn.textContent = 'רוצים לדעת יותר? קראו על מבנה הסונטה';
        } else {
            explanationDiv.classList.add('visible');
            toggleExplanationBtn.textContent = 'הסתרת ההסבר';
        }
    });


    // Optional: Add animation class to selected letter span on change
     rhymeSelects.forEach((select) => {
        select.addEventListener('change', () => {
            const selectedLetterSpan = select.closest('.line').querySelector('.selected-letter');
             // Reset animation by cloning the element
            const newSpan = selectedLetterSpan.cloneNode(true);
            selectedLetterSpan.parentNode.replaceChild(newSpan, selectedLetterSpan);
            newSpan.textContent = select.value === '' ? '?' : select.value;
        });
         // Initial display setup
         const selectedLetterSpan = select.closest('.line').querySelector('.selected-letter');
         selectedLetterSpan.textContent = select.value === '' ? '?' : select.value;
    });

});
</script>
---