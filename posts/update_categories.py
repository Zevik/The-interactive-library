import os
import re

def update_files_categories():
    """
    This script iterates over all files in a specified directory,
    reads the 'category' from the frontmatter, and updates it based
    on a predefined mapping.
    """
    # שנה את הנתיב בהתאם למיקום התיקייה במחשב שלך
    # הסקריפט מניח שהוא נמצא בתוך תיקיית posts. אם לא, יש לספק נתיב מלא.
    directory_path = '.' 

    # מילון המיפוי מקטגוריות ישנות לחדשות
    category_mapping = {
        # טכנולוגיה והנדסה
        "אבטחת מידע": "טכנולוגיה / סייבר ואבטחת מידע",
        "אבטחת מידע וסייבר": "טכנולוגיה / סייבר ואבטחת מידע",
        "טכנולוגיה / בלוקצ'יין": "טכנולוגיה / מדעי המחשב",
        "מדעי המחשב": "טכנולוגיה / מדעי המחשב",
        "מדעי המחשב / בינה מלאכותית": "טכנולוגיה / בינה מלאכותית",
        "מדעי המחשב / למידת מכונה": "טכנולוגיה / בינה מלאכותית",
        "בינה מלאכותית": "טכנולוגיה / בינה מלאכותית",
        "מדעי המחשב / היסטוריה": "טכנולוגיה / מדעי המחשב",
        "מדעי המחשב והנדסה": "טכנולוגיה / מדעי המחשב",
        "מדעי המחשב ויצירה": "טכנולוגיה / מדעי המחשב",
        "אלגוריתמים": "טכנולוגיה / מדעי המחשב",
        "קריפטוגרפיה": "טכנולוגיה / סייבר ואבטחת מידע",
        "הנדסה": "טכנולוגיה / הנדסה",
        "הנדסה אזרחית": "טכנולוגיה / הנדסה",
        "אדריכלות והנדסה אזרחית": "טכנולוגיה / הנדסה",
        "הנדסה וחומרים": "טכנולוגיה / הנדסת חומרים",
        "הנדסה ומדע החומרים": "טכנולוגיה / הנדסת חומרים",
        "הנדסת חומרים": "טכנולוגיה / הנדסת חומרים",
        "מדע החומרים": "טכנולוגיה / הנדסת חומרים",
        "מדע חומרים והנדסה": "טכנולוגיה / הנדסת חומרים",
        "הנדסה ומדעי החלל": "טכנולוגיה / אווירונאוטיקה וחלל",
        "אווירנאוטיקה וקבלת החלטות": "טכנולוגיה / אווירונאוטיקה וחלל",
        "הנדסה ומערכות": "טכנולוגיה / הנדסה",
        "הנדסה כימית": "טכנולוגיה / הנדסה כימית",
        "הנדסה סביבתית": "מדעי הסביבה / הנדסה סביבתית",
        "הנדסת חשמל": "טכנולוגיה / הנדסת חשמל",
        "הנדסת חשמל ואלקטרוניקה": "טכנולוגיה / הנדסת חשמל",
        "פיזיקה / הנדסת חשמל": "טכנולוגיה / הנדסת חשמל",
        "הנדסת רכב": "טכנולוגיה / הנדסת רכב",
        "הנדסת רכב / פיזיקה יישומית": "טכנולוגיה / הנדסת רכב",
        "רובוטיקה": "טכנולוגיה / רובוטיקה",
        "טכנולוגיה פרימיטיבית": "טכנולוגיה / היסטוריה של הטכנולוגיה",
        "היסטוריה של הטכנולוגיה": "טכנולוגיה / היסטוריה של הטכנולוגיה",
        "היסטוריה וטכנולוגיה": "טכנולוגיה / היסטוריה של הטכנולוגיה",
        "היסטוריה וטכנולוגיה עתיקה": "טכנולוגיה / היסטוריה של הטכנולוגיה",
        "מחשבים וטכנולוגיה": "טכנולוגיה / כללי",
        
        # מדעים מדויקים
        "פיזיקה": "מדעים מדויקים / פיזיקה",
        "Physics": "מדעים מדויקים / פיזיקה",
        "פיזיקה - אור וצבע": "מדעים מדויקים / פיזיקה",
        "פיזיקה ואטמוספרה": "מדעים מדויקים / פיזיקה",
        "פיזיקה ואסטרונומיה": "מדעים מדויקים / אסטרונומיה",
        "אסטרונומיה": "מדעים מדויקים / אסטרונומיה",
        "אסטרונומיה ואסטרופיזיקה": "מדעים מדויקים / אסטרונומיה",
        "אסטרונומיה והיסטוריה": "מדעים מדויקים / אסטרונומיה",
        "אסטרונומיה וסביבה": "מדעים מדויקים / אסטרונומיה",
        "פיזיקה ואקלים": "מדעים מדויקים / פיזיקה",
        "פיזיקה והידרוסטטיקה": "מדעים מדויקים / פיזיקה",
        "פיזיקה והיסטוריה של המדע": "מדעים מדויקים / פיזיקה",
        "פיזיקה וטכנולוגיה": "מדעים מדויקים / פיזיקה",
        "פיזיקה קוונטית": "מדעים מדויקים / פיזיקה",
        "פיזיקה קסומה": "מדעים מדויקים / פיזיקה",
        "פיזיקה רפואית": "מדעים מדויקים / פיזיקה",
        "פיזיקה שימושית": "מדעים מדויקים / פיזיקה",
        "כימיה": "מדעים מדויקים / כימיה",
        "ביולוגיה וכימיה": "מדעים מדויקים / כימיה",
        "מתמטיקה": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה והסתברות": "מדעים מדויקים / מתמטיקה",
        "הסתברות": "מדעים מדויקים / מתמטיקה",
        "הסתברות וסטטיסטיקה": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה וחשיבה": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה ויזואלית": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה ולוגיקה": "מדעים מדויקים / מתמטיקה",
        "לוגיקה": "מדעים מדויקים / מתמטיקה",
        "לוגיקה וחשיבה ביקורתית": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה ומדעים": "מדעים מדויקים / מתמטיקה",
        "מתמטיקה וסטטיסטיקה": "מדעים מדויקים / מתמטיקה",
        "תיאוריה של משחקים": "מדעים מדויקים / מתמטיקה",

        # מדעי החיים והרפואה
        "ביולוגיה": "מדעי החיים / ביולוגיה",
        "Biology": "מדעי החיים / ביולוגיה",
        "אבולוציה": "מדעי החיים / ביולוגיה",
        "ביולוגיה / חקלאות אורבנית / טכנולוגיה": "מדעי החיים / ביולוגיה",
        "ביולוגיה / פיזיולוגיה": "מדעי החיים / פיזיולוגיה",
        "פיזיולוגיה": "מדעי החיים / פיזיולוגיה",
        "פיזיולוגיה חושית": "מדעי החיים / פיזיולוגיה",
        "ביולוגיה אבולוציונית": "מדעי החיים / ביולוגיה",
        "ביולוגיה התנהגותית": "מדעי החיים / ביולוגיה",
        "ביולוגיה התפתחותית": "מדעי החיים / ביולוגיה",
        "ביולוגיה ואבולוציה": "מדעי החיים / ביולוגיה",
        "ביולוגיה ופיזיולוגיה": "מדעי החיים / פיזיולוגיה",
        "ביולוגיה ורפואה": "מדעי החיים / רפואה",
        "ביולוגיה חישובית": "מדעי החיים / ביולוגיה",
        "ביולוגיה ימית": "מדעי החיים / ביולוגיה ימית",
        "ביולוגיה ימית וטכנולוגיה": "מדעי החיים / ביולוגיה ימית",
        "ביולוגיה מולקולרית": "מדעי החיים / ביולוגיה",
        "ביולוגיה מולקולרית ותאית": "מדעי החיים / ביולוגיה",
        "ביולוגיה מתקדמת": "מדעי החיים / ביולוגיה",
        "בוטניקה": "מדעי החיים / ביולוגיה",
        "מיקרוביולוגיה": "מדעי החיים / ביולוגיה",
        "מיקרוביולוגיה ומדעי המזון": "מדעי החיים / מדעי המזון",
        "מדעי המזון": "מדעי החיים / מדעי המזון",
        "מדעי המזון הקסומים": "מדעי החיים / מדעי המזון",
        "נוירוביולוגיה התפתחותית": "מדעי החיים / מדעי המוח",
        "מדעי המוח": "מדעי החיים / מדעי המוח",
        "מדעי המוח וקבלת החלטות": "מדעי החיים / מדעי המוח",
        "ביואתיקה": "מדעי החיים / רפואה",
        "דימות רפואי וגרעיני": "מדעי החיים / רפואה",
        "היסטוריה של הרפואה": "מדעי החיים / רפואה",
        "רפואה ורגולציה": "מדעי החיים / רפואה",
        
        # מדעי כדור הארץ והסביבה
        "מדעי כדור הארץ": "מדעי הסביבה / כדור הארץ",
        "Earth Science": "מדעי הסביבה / כדור הארץ",
        "גיאולוגיה ומדעי כדור הארץ": "מדעי הסביבה / כדור הארץ",
        "מדעי כדור הארץ / גיאולוגיה": "מדעי הסביבה / כדור הארץ",
        "מדעי כדור הארץ והסביבה": "מדעי הסביבה / כדור הארץ",
        "מסתורי כדור הארץ": "מדעי הסביבה / כדור הארץ",
        "גאולוגיה": "מדעי הסביבה / גיאולוגיה",
        "גיאולוגיה": "מדעי הסביבה / גיאולוגיה",
        "גאופיזיקה": "מדעי הסביבה / גיאולוגיה",
        "גיאופיזיקה": "מדעי הסביבה / גיאולוגיה",
        "פלאונטולוגיה": "מדעי הסביבה / פלאונטולוגיה",
        "פליאונטולוגיה": "מדעי הסביבה / פלאונטולוגיה",
        "ארכיאולוגיה ואבולוציה": "מדעי הרוח / ארכאולוגיה",
        "אקולוגיה": "מדעי הסביבה / אקולוגיה וקיימות",
        "אקולוגיה ושימור": "מדעי הסביבה / אקולוגיה וקיימות",
        "אקולוגיה ושימור טבע": "מדעי הסביבה / אקולוגיה וקיימות",
        "אקולוגיה ימית": "מדעי הסביבה / אקולוגיה וקיימות",
        "סביבה ומדע": "מדעי הסביבה / כללי",
        "סביבה וקיימות": "מדעי הסביבה / אקולוגיה וקיימות",
        "קיימות": "מדעי הסביבה / אקולוגיה וקיימות",
        "מדעי הסביבה": "מדעי הסביבה / כללי",
        "ביולוגיה סביבתית": "מדעי הסביבה / כללי",
        "מדעי הסביבה וניהול": "מדעי הסביבה / כללי",
        "גאוגרפיה": "מדעי הסביבה / גאוגרפיה",
        "גיאוגרפיה": "מדעי הסביבה / גאוגרפיה",
        "גאוגרפיה אורבנית": "מדעי הסביבה / גאוגרפיה",
        "גאוגרפיה אנושית": "מדעי החברה / גאוגרפיה",
        "גאוגרפיה וגאולוגיה": "מדעי הסביבה / גאוגרפיה",
        "גאוגרפיה פיזית": "מדעי הסביבה / גאוגרפיה",
        "גיאוגרפיה פיזית": "מדעי הסביבה / גאוגרפיה",
        "אוקיינוגרפיה / פיזיקה": "מדעי הסביבה / אוקיינוגרפיה",
        "גלציולוגיה ואוקיינוגרפיה": "מדעי הסביבה / אוקיינוגרפיה",
        "מדעי הים": "מדעי הסביבה / אוקיינוגרפיה",
        "מדעי האטמוספרה": "מדעי הסביבה / מדעי האטמוספרה",
        "מטאורולוגיה": "מדעי הסביבה / מדעי האטמוספרה",
        "אגרוטכנולוגיה": "מדעי החקלאות / אגרוטכנולוגיה",
        
        # מדעי החברה
        "כלכלה": "מדעי החברה / כלכלה ופיננסים",
        "כלכלה אישית": "מדעי החברה / כלכלה ופיננסים",
        "פיננסים": "מדעי החברה / כלכלה ופיננסים",
        "פיננסים אישיים": "מדעי החברה / כלכלה ופיננסים",
        "כלכלה התנהגותית": "מדעי החברה / כלכלה התנהגותית",
        "כלכלה התנהגותית ותכנון עירוני": "מדעי החברה / כלכלה התנהגותית",
        "כלכלה ומימון": "מדעי החברה / כלכלה ופיננסים",
        "כלכלה וניהול": "מדעי החברה / כלכלה ופיננסים",
        "כלכלה, חברה ותהליכים חברתיים": "מדעי החברה / כלכלה וסוציולוגיה",
        "היסטוריה כלכלית": "מדעי החברה / היסטוריה כלכלית",
        "פסיכולוגיה": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה התנהגותית": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה התפתחותית": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה חברתית": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה ניסויית": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה פיזיולוגית": "מדעי החברה / פסיכולוגיה",
        "פסיכולוגיה קוגניטיבית": "מדעי החברה / פסיכולוגיה",
        "מדעי הקוגניציה": "מדעי החברה / פסיכולוגיה",
        "קוגניציה": "מדעי החברה / פסיכולוגיה",
        "חשיבה קוגניטיבית": "מדעי החברה / פסיכולוגיה",
        "סוציולוגיה": "מדעי החברה / סוציולוגיה ואנתרופולוגיה",
        "סוציולוגיה וכלכלה התנהגותית": "מדעי החברה / סוציולוגיה ואנתרופולוגיה",
        "אנתרופולוגיה": "מדעי החברה / סוציולוגיה ואנתרופולוגיה",
        "אנתרופולוגיה תרבותית": "מדעי החברה / סוציולוגיה ואנתרופולוגיה",
        "מדע המדינה": "מדעי החברה / מדע המדינה ומדיניות ציבורית",
        "מדעי המדינה": "מדעי החברה / מדע המדינה ומדיניות ציבורית",
        "מדיניות ציבורית": "מדעי החברה / מדע המדינה ומדיניות ציבורית",
        "מנהל ומדיניות ציבורית": "מדעי החברה / מדע המדינה ומדיניות ציבורית",
        "רגולציה ומדיניות ציבורית": "מדעי החברה / מדע המדינה ומדיניות ציבורית",
        "תכנון עירוני": "מדעי החברה / תכנון עירוני",
        "תכנון עירוני ואזורי": "מדעי החברה / תכנון עירוני",
        "מדעי החברה": "מדעי החברה / כללי",
        
        # מדעי הרוח
        "היסטוריה": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "היסטוריה עולמית": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "היסטוריה וארכיאולוגיה": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "היסטוריה ימית": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "ארכאולוגיה": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "ארכיאולוגיה": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "ארכיאולוגיה והיסטוריה": "מדעי הרוח / היסטוריה וארכאולוגיה",
        "פילוסופיה": "מדעי הרוח / פילוסופיה",
        "פילוסופיה של הנפש": "מדעי הרוח / פילוסופיה",
        "אתיקה": "מדעי הרוח / פילוסופיה",
        "את'יקה וטכנולוגיה": "מדעי הרוח / פילוסופיה",
        "בלשנות": "מדעי הרוח / בלשנות",
        "בלשנות חישובית": "מדעי הרוח / בלשנות",
        "לשון עברית": "מדעי הרוח / בלשנות",
        "ספרות": "מדעי הרוח / ספרות וכתיבה",
        "כתיבה יוצרת": "מדעי הרוח / ספרות וכתיבה",
        "רטוריקה וטיעון": "מדעי הרוח / כללי",
        "היסטוריה של המדע": "מדעי הרוח / היסטוריה של המדע",
        "היסטוריה של המדע והטכנולוגיה": "מדעי הרוח / היסטוריה של המדע",
        "מדע של מדע": "מדעי הרוח / פילוסופיה של המדע",
        "מדעי הרוח": "מדעי הרוח / כללי",
        
        # אמנות ועיצוב
        "אומנות": "אמנות ועיצוב / כללי",
        "אמנות": "אמנות ועיצוב / כללי",
        "אומנות דיגיטלית ומדיה": "אמנות ועיצוב / אמנות דיגיטלית",
        "אומנות ומדיה": "אמנות ועיצוב / אמנות דיגיטלית",
        "אמנות ומדיה": "אמנות ועיצוב / אמנות דיגיטלית",
        "אומנות ומלאכה": "אמנות ועיצוב / מלאכות יד",
        "אמנות ומלאכת יד": "אמנות ועיצוב / מלאכות יד",
        "אמנות ומלאכות מסורתיות": "אמנות ועיצוב / מלאכות יד",
        "אומנות ועיצוב": "אמנות ועיצוב / כללי",
        "אמנות ועיצוב": "אמנות ועיצוב / כללי",
        "Arts and Design": "אמנות ועיצוב / כללי",
        "אמנות חזותית": "אמנות ועיצוב / אמנות חזותית",
        "היסטוריה של אמנות": "אמנות ועיצוב / תולדות האמנות",
        "היסטוריה של האמנות": "אמנות ועיצוב / תולדות האמנות",
        "תולדות האמנות": "אמנות ועיצוב / תולדות האמנות",
        "אדריכלות": "אמנות ועיצוב / אדריכלות",
        "אדריכלות והיסטוריה של האמנות": "אמנות ועיצוב / אדריכלות",
        "אמנות ואדריכלות": "אמנות ועיצוב / אדריכלות",
        "עיצוב גרפי": "אמנות ועיצוב / עיצוב גרפי",
        "גרפיקה ועיצוב": "אמנות ועיצוב / עיצוב גרפי",
        "עיצוב גרפי ודיגיטלי": "אמנות ועיצוב / עיצוב גרפי",
        "עיצוב גרפי וטיפוגרפיה": "אמנות ועיצוב / עיצוב גרפי",
        "טיפוגרפיה": "אמנות ועיצוב / עיצוב גרפי",
        "עיצוב גרפי ותקשורת חזותית": "אמנות ועיצוב / עיצוב גרפי",
        "גרפיקה ואנימציה": "אמנות ועיצוב / אנימציה",
        "מוזיקה": "אמנות ועיצוב / מוזיקה",
        "מוסיקה": "אמנות ועיצוב / מוזיקה",
        "חקר המוזיקה": "אמנות ועיצוב / מוזיקה",
        "מוזיקה וטכנולוגיה": "אמנות ועיצוב / מוזיקה",
        "טכנולוגיית המוזיקה": "אמנות ועיצוב / מוזיקה",
        "מוזיקולוגיה": "אמנות ועיצוב / מוזיקה",
        "פסיכואקוסטיקה": "אמנות ועיצוב / מוזיקה",
        "תורת המוזיקה": "אמנות ועיצוב / מוזיקה",
        "תיאוריה של המוזיקה": "אמנות ועיצוב / מוזיקה",
        "אמנות הקולנוע": "אמנות ועיצוב / קולנוע",
        "קולנוע וטלוויזיה": "אמנות ועיצוב / קולנוע",
        "קולנוע ותקשורת": "אמנות ועיצוב / קולנוע",
        "אמנות הבמה - מחול": "אמנות ועיצוב / אמנויות הבמה",
        "תיאטרון והיסטוריה": "אמנות ועיצוב / אמנויות הבמה",
        "עיצוב ואופנה": "אמנות ועיצוב / אופנה וטקסטיל",
        "מדעי הטקסטיל": "אמנות ועיצוב / אופנה וטקסטיל",
        
        # ניהול ועסקים
        "ניהול": "ניהול ועסקים / ניהול",
        "ניהול אמנות": "ניהול ועסקים / ניהול תרבות",
        "ניהול תרבות ואמנות": "ניהול ועסקים / ניהול תרבות",
        "ניהול אסונות": "ניהול ועסקים / ניהול",
        "ניהול וכלכלה": "ניהול ועסקים / ניהול",
        "ניהול ומלכ\\": "ניהול ועסקים / ניהול", # Handle potential typo
        "ניהול ועסקים": "ניהול ועסקים / ניהול",
        "ניהול משאבים וקיימות": "ניהול ועסקים / ניהול",
        "ניהול עסקי": "ניהול ועסקים / ניהול",
        "ניהול עסקים": "ניהול ועסקים / ניהול",
        "מנהל עסקים": "ניהול ועסקים / ניהול",
        "אמנות הניהול": "ניהול ועסקים / ניהול",
        "משפט וקניין רוחני": "ניהול ועסקים / משפטים",
        "קניין רוחני וחדשנות": "ניהול ועסקים / משפטים",
        "משפט מנהלי וציבורי": "ניהול ועסקים / משפטים",
        "משפטים": "ניהול ועסקים / משפטים",
        
        # מיומנויות וחינוך
        "חינוך מיוחד": "מיומנויות וחינוך / חינוך",
        "חשיבה ביקורתית": "מיומנויות וחינוך / חשיבה ומחקר",
        "קבלת החלטות": "מיומנויות וחינוך / חשיבה ומחקר",
        "מדעי ההחלטה והסיכון": "מיומנויות וחינוך / חשיבה ומחקר",
        "ניהול סיכונים": "מיומנויות וחינוך / חשיבה ומחקר",
        "מיומנויות חיוניות": "מיומנויות וחינוך / כללי",
        "מתודולוגיה מחקרית": "מיומנויות וחינוך / חשיבה ומחקר",
        "Research Management": "מיומנויות וחינוך / חשיבה ומחקר",
        
        # כללי
        "מדע": "כללי",
        "מדע וטכנולוגיה": "כללי",
        "הדמיות מדעיות": "כללי",
        "לימודי תרבות": "כללי",
        "סימולציות": "כללי",
        "משחק לימודי": "כללי"
    }

    updated_files_count = 0
    not_found_count = 0

    # Pattern to find the category line
    # Handles both 'category: "..."' and 'category: ...'
    category_pattern = re.compile(r'^(category\s*:\s*["\']?)(.*?)(["\']?\s*)$', re.MULTILINE)

    for filename in os.listdir(directory_path):
        # Optional: process only markdown files, adjust as needed
        # if not filename.endswith(".md"): 
        #     continue

        file_path = os.path.join(directory_path, filename)

        if os.path.isfile(file_path):
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()

                # Use regex to find and process the category
                match = category_pattern.search(content)

                if match:
                    old_category_full_line = match.group(0)
                    old_category_value = match.group(2).strip()

                    if old_category_value in category_mapping:
                        new_category_value = category_mapping[old_category_value]
                        
                        if new_category_value != old_category_value:
                            # Reconstruct the line with the new category, preserving original quotes
                            new_category_line = f'{match.group(1)}{new_category_value}{match.group(3)}'
                            new_content = content.replace(old_category_full_line, new_category_line)
                            
                            # Write the changes back to the file
                            with open(file_path, 'w', encoding='utf-8') as f:
                                f.write(new_content)
                            
                            print(f"✅ עודכן הקובץ: '{filename}' | קטגוריה שונתה מ: '{old_category_value}' -> ל: '{new_category_value}'")
                            updated_files_count += 1
                        else:
                            # The mapped category is the same as the old one, no change needed.
                             pass

                    else:
                        print(f"⚠️ קטגוריה לא נמצאה במיפוי עבור הקובץ '{filename}': '{old_category_value}'")
                        not_found_count += 1
                
                # else:
                #     print(f"INFO: No category found in file '{filename}'")

            except Exception as e:
                print(f"❌ שגיאה בעיבוד הקובץ '{filename}': {e}")

    print("\n--- סיכום ---")
    print(f"סה\"כ קבצים שעודכנו: {updated_files_count}")
    print(f"סה\"כ קטגוריות שלא נמצאו במילון המיפוי: {not_found_count}")

# ---- הרצת הפונקציה ----
if __name__ == "__main__":
    update_files_categories()