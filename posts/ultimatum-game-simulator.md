---
title: "המשחק האולטימטיבי: סימולטור חלוקה והוגנות"
english_slug: ultimatum-game-simulator
category: "מדעי החברה / כלכלה התנהגותית"
tags: [משחקים, קבלת החלטות, הוגנות, שיתוף פעולה, פסיכולוגיה, ניסוי]
---
# המשחק האולטימטיבי: סימולטור חלוקה והוגנות

**הקדמה לפעולה:** דמיינו שאתם עומדים בפני דילמה מרתקת: אדם אחד מחזיק בסכום כסף וצריך להציע חלק ממנו לאדם אחר. האדם השני לא יכול להתמקח - רק להחליט אם לקבל את ההצעה או לדחות אותה לחלוטין. אם ההצעה מתקבלת, שניהם מקבלים את החלקים שסוכמו. אם היא נדחית, אף אחד לא מקבל כלום. איך תפעלו כשאתם מציעים? ומה תעשו כשיציעו לכם הצעה שנראית "לא הוגנת"? הכירו את **משחק האולטימטום** - כלי עוצמתי לחשיפת המתח בין רציונליות קרה לבין הרצון להוגנות. הסימולטור הזה מזמין אתכם לצלול ללב ההתלבטות הזו, ולהבין איך התנהגות "לא רציונלית" לכאורה יכולה להשפיע דרמטית על התוצאות.

<div class="ultimatum-game-container">
    <div class="game-header">
        <i class="icon-money"></i>
        <h2>שחקו עם החוקים</h2>
        <i class="icon-scale"></i>
    </div>

    <div class="settings game-section">
        <div class="setting-item">
            <label for="total-amount">האוצר לחלוקה (בשקלים חדשים):</label>
            <input type="number" id="total-amount" value="100" min="1" step="1" class="game-input">
        </div>
        <div class="setting-item">
            <label for="num-rounds">כמה סבבי משחק נדמה?:</label>
            <input type="number" id="num-rounds" value="100" min="10" step="10" class="game-input">
        </div>
        <div class="setting-item">
            <label for="min-acceptance">סף ההוגנות של המקבל (אחוזים - מה המינימום שהוא יקבל?):</label>
            <input type="number" id="min-acceptance" value="30" min="0" max="100" step="5" class="game-input">
        </div>
        <button id="start-simulation" class="game-button">
            <i class="icon-play"></i>
            <span>הפעל את הסימולציה המרתקת!</span>
        </button>
    </div>

    <div class="simulation-results game-section">
        <div class="game-header">
             <i class="icon-chart"></i>
            <h2>תוצאות הסימולציה הגדולה</h2>
            <i class="icon-trophy"></i>
        </div>

        <div class="results-summary">
            <p>סבבים ששוחקו: <span id="rounds-executed" class="highlight-value">0</span> מתוך <span id="total-sim-rounds" class="total-value">0</span></p>
            <div class="progress-bar-container">
                <div class="progress-bar" id="simulation-progress"></div>
            </div>
            <p>הצעות שזכו להסכמה: <span id="accepted-count" class="highlight-value accepted">0</span> <i class="icon-accepted"></i></p>
            <p>הצעות שנדחו בבוז: <span id="rejected-count" class="highlight-value rejected">0</span> <i class="icon-rejected"></i></p>
            <p>אחוז ההסכמה הכולל: <span id="acceptance-rate" class="highlight-value accepted">0%</span></p>
            <p>סכום כולל שחולק בפועל: <span id="total-shared" class="highlight-value total">0</span> ש"ח <i class="icon-money-bag"></i></p>
        </div>

        <div class="results-visuals">
             <h3>פיזור ההצעות ותגובות המקבלים</h3>
             <p class="visuals-description">ציר זה מציג את ההצעות ששחקן 1 הציע למקבל (באחוזים), ואיך המקבל הגיב לכל טווח הצעות בהתאם ל"סף ההוגנות" שהגדרתם.</p>
             <div class="offer-buckets-container" id="offer-buckets-container">
                 <!-- Buckets will be generated by JS -->
                 <div class="bucket-label" style="width: 10%;">0-9%</div>
                 <div class="bucket-label" style="width: 10%;">10-19%</div>
                 <div class="bucket-label" style="width: 10%;">20-29%</div>
                 <div class="bucket-label" style="width: 10%;">30-39%</div>
                 <div class="bucket-label" style="width: 10%;">40-49%</div>
                 <div class="bucket-label" style="width: 10%;">50-59%</div>
                 <div class="bucket-label" style="width: 10%;">60-69%</div>
                 <div class="bucket-label" style="width: 10%;">70-79%</div>
                 <div class="bucket-label" style="width: 10%;">80-89%</div>
                 <div class="bucket-label" style="width: 10%;">90-100%</div>
                 <div class="offer-buckets-bar-container">
                     <!-- Offer bars will be injected here -->
                 </div>
             </div>
         </div>


        <div class="results-graph">
            <h3>סיכום ויזואלי: הצעות מול תוצאות</h3>
            <canvas id="resultsChart"></canvas>
        </div>
    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');

    /* Basic Reset/Base */
    .ultimatum-game-container * {
        box-sizing: border-box;
    }

    .ultimatum-game-container {
        font-family: 'Varela Round', sans-serif;
        max-width: 760px; /* Slightly wider */
        margin: 30px auto;
        padding: 30px; /* More padding */
        background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); /* Gentle gradient */
        border-radius: 15px; /* More rounded corners */
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); /* Deeper shadow */
        text-align: right;
        direction: rtl;
        color: #212529; /* Darker text for contrast */
        overflow: hidden; /* Clear floats/margins */
    }

    .game-header {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 25px;
        color: #007bff; /* Primary blue */
    }

    .game-header h2 {
        margin: 0 15px;
        font-size: 1.8em; /* Larger heading */
        font-weight: bold;
        color: #0056b3; /* Slightly darker blue */
        text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }

    .game-header i {
        font-size: 1.5em;
        color: #007bff;
        /* Simple Icons (replace with real icons if available in production env) */
    }
     .icon-money::before { content: '💰'; }
     .icon-scale::before { content: '⚖️'; }
     .icon-chart::before { content: '📊'; }
     .icon-trophy::before { content: '🏆'; }
     .icon-play::before { content: '▶️'; }
     .icon-accepted::before { content: '✅'; }
     .icon-rejected::before { content: '❌'; }
     .icon-money-bag::before { content: '💸'; }


    .game-section {
        background-color: #ffffff; /* White background for sections */
        padding: 25px; /* More padding */
        border-radius: 10px; /* Rounded corners */
        margin-bottom: 25px; /* Space between sections */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Section shadow */
        border: 1px solid #e9ecef; /* Subtle border */
    }

    .settings .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px; /* More space */
        padding-bottom: 15px;
        border-bottom: 1px dashed #dee2e6; /* Dashed border */
    }

    .settings .setting-item:last-child {
        margin-bottom: 0;
        border-bottom: none;
        padding-bottom: 0;
    }

    .setting-item label {
        flex-grow: 1;
        margin-left: 15px; /* More space */
        font-weight: bold;
        color: #495057; /* Dark gray */
        font-size: 1.1em;
    }

    .game-input {
        width: 90px; /* Slightly wider input */
        padding: 10px 12px; /* More padding */
        border: 1px solid #ced4da;
        border-radius: 6px; /* Rounded input */
        text-align: center;
        font-size: 1em;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        background-color: #f8f9fa; /* Light background */
    }

    .game-input:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
        background-color: #fff;
    }

    /* Remove arrow buttons for number input */
    .game-input::-webkit-outer-spin-button,
    .game-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
     .game-input {-moz-appearance: textfield;} /* Firefox */


    .game-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 15px; /* More padding */
        background-color: #28a745; /* Green button */
        color: white;
        border: none;
        border-radius: 8px; /* More rounded */
        font-size: 1.2em; /* Larger text */
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.15s ease, opacity 0.3s ease;
        margin-top: 25px; /* More space */
        box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2);
    }

    .game-button i {
        margin-left: 10px;
        font-size: 1.3em;
    }

    .game-button:hover:not(:disabled) {
        background-color: #218838; /* Darker green on hover */
        box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
    }

    .game-button:active:not(:disabled) {
        transform: scale(0.98);
    }

    .game-button:disabled {
        background-color: #6c757d; /* Gray when disabled */
        cursor: not-allowed;
        opacity: 0.7;
        box-shadow: none;
    }


    /* Results Summary Styles */
    .results-summary p {
        margin-bottom: 12px; /* More space */
        font-size: 1.15em; /* Slightly larger text */
        color: #495057; /* Dark gray */
        display: flex;
        align-items: center;
        justify-content: space-between; /* Align text and value/icon */
    }

    .results-summary p:last-child {
         margin-bottom: 0;
    }

    .results-summary p span {
        font-weight: bold;
        margin-right: 10px; /* Space between value and icon */
    }

    .results-summary .highlight-value {
        color: #007bff; /* Primary blue for values */
    }
    .highlight-value.accepted { color: #28a745; } /* Green for accepted */
    .highlight-value.rejected { color: #dc3545; } /* Red for rejected */
    .highlight-value.total { color: #17a2b8; } /* Teal for total shared */


    /* Progress Bar */
    .progress-bar-container {
        width: 100%;
        background-color: #e9ecef;
        border-radius: 5px;
        margin-top: 15px;
        margin-bottom: 20px;
        overflow: hidden;
        height: 15px; /* Thicker bar */
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .progress-bar {
        height: 100%;
        width: 0%;
        background-color: #007bff; /* Primary blue */
        border-radius: 5px;
        transition: width 0.4s ease-in-out; /* Smooth animation */
    }

    /* Visual Buckets */
    .results-visuals {
        margin-top: 25px;
        border-top: 1px dashed #dee2e6;
        padding-top: 25px;
        text-align: center;
    }

    .results-visuals h3 {
        color: #0056b3;
        margin-bottom: 10px;
        font-size: 1.3em;
    }
    .visuals-description {
        font-size: 0.95em;
        color: #5a6268;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    .offer-buckets-container {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping if needed */
        width: 100%;
        margin-bottom: 15px;
        position: relative; /* Needed for absolute positioning of bars */
        min-height: 150px; /* Ensure space */
        padding-top: 20px; /* Space for labels */
        border-bottom: 1px solid #ced4da;
    }

     .bucket-label {
        position: absolute;
        top: 0;
        height: 20px;
        font-size: 0.8em;
        color: #5a6268;
        text-align: center;
        transform: translateX(50%); /* Center label above the bucket start */
     }
     .bucket-label:first-child { transform: translateX(0%); text-align: right; }
     .bucket-label:last-child { transform: translateX(-50%); text-align: left;}


     .offer-buckets-bar-container {
         position: absolute;
         bottom: 0;
         left: 0;
         right: 0;
         display: flex;
         align-items: flex-end; /* Align bars to the bottom */
         height: 100%;
         padding-bottom: 0px; /* Space below bars */
     }


    .offer-bucket-bar {
        flex-grow: 1;
        width: 10%; /* Base width */
        display: flex;
        flex-direction: column; /* Stack accepted/rejected */
        justify-content: flex-end; /* Stack from bottom */
        height: 100%; /* Max height */
        margin: 0 1px; /* Small gap between buckets */
        background-color: #e9ecef; /* Background for the bucket column */
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        overflow: hidden; /* Hide overflow during animation */
    }
    .offer-bucket-bar:first-child { margin-right: 0; }
     .offer-bucket-bar:last-child { margin-left: 0; }

    .bucket-segment {
        width: 100%; /* Fill bucket width */
        transition: height 0.4s ease-out; /* Animate height */
    }

    .bucket-segment.accepted {
        background-color: rgba(40, 167, 69, 0.7); /* Greenish with alpha */
    }

    .bucket-segment.rejected {
        background-color: rgba(220, 53, 69, 0.7); /* Reddish with alpha */
    }

    /* Chart Styles */
    .results-graph {
        margin-top: 25px;
        border-top: 1px dashed #dee2e6;
        padding-top: 25px;
        text-align: center;
    }

    .results-graph h3 {
        color: #0056b3;
        margin-bottom: 15px;
        font-size: 1.3em;
    }

    #resultsChart {
        width: 100% !important;
        max-height: 350px; /* Control chart height */
        min-height: 250px;
    }

    /* Explanation Toggle Button */
    #toggle-explanation-button {
        display: block;
        width: fit-content;
        margin: 20px auto;
        padding: 10px 25px; /* More padding */
        background-color: #17a2b8; /* Teal color */
        color: white;
        border: none;
        border-radius: 25px; /* Pill shape */
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease;
        box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
        font-family: 'Varela Round', sans-serif; /* Consistent font */
    }

    #toggle-explanation-button:hover {
        background-color: #138496; /* Darker teal */
        box-shadow: 0 4px 10px rgba(23, 162, 184, 0.4);
    }

    #toggle-explanation-button:active {
        transform: scale(0.98);
    }

    /* Explanation Content */
    .explanation-content {
        display: none; /* Hidden by default */
        margin-top: 25px;
        padding: 25px;
        background-color: #e9ecef; /* Light background */
        border-radius: 10px;
        line-height: 1.7; /* Improved readability */
        color: #343a40; /* Darker text */
        text-align: right;
        direction: rtl;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border: 1px solid #ced4da;
    }

    .explanation-content h2 {
        color: #0056b3;
        margin-top: 0; /* No top margin for first heading */
        margin-bottom: 15px;
        font-size: 1.6em;
        text-align: center;
    }
     .explanation-content h3 {
        color: #007bff;
        margin-top: 20px; /* Space before subheadings */
        margin-bottom: 10px;
        font-size: 1.3em;
     }

    .explanation-content p {
        margin-bottom: 15px;
    }

    .explanation-content strong {
        color: #0056b3; /* Blue for emphasis */
        font-weight: bold;
    }

    .explanation-content ol, .explanation-content ul {
        margin-bottom: 15px;
        padding-right: 20px;
    }
    .explanation-content li {
        margin-bottom: 8px;
    }


</style>

<button id="toggle-explanation-button">מה זה בעצם? הסבר על המשחק!</button>

<div class="explanation-content">
    <h2>הסבר מורחב: משחק האולטימטום</h2>
    <p>משחק האולטימטום הוא אחד הכלים המרכזיים בכלכלה התנהגותית ובפסיכולוגיה חברתית לחקר קבלת החלטות בתנאי אי-ודאות, במיוחד בהקשר של משא ומתן וחלוקת משאבים. הוא חושף בצורה דרמטית כיצד שיקולים של **הוגנות** ורצון להעניש חוסר הוגנות מתנגשים עם הרציונליות הכלכלית הטהורה.</p>

    <h3>מכניקת המשחק הבסיסית:</h3>
    <p>המשחק מערב שני שחקנים אנונימיים (לרוב) וסכום כסף מוגדר מראש:</p>
    <ol>
        <li><strong>המציע (שחקן 1):</strong> מקבל את כל הסכום וצריך להציע חלק כלשהו ממנו לשחקן השני. ההצעה יכולה להיות כל סכום בין 0 לבין הסכום המלא.</li>
        <li><strong>המקבל (שחקן 2):</strong> מקבל את ההצעה ויכול רק לומר "כן" או "לא".
            <ul>
                <li>אם המקבל אומר **"כן"**: ההצעה מתקבלת, והכסף מתחלק לפי ההצעה של שחקן 1.</li>
                <li>אם המקבל אומר **"לא"**: ההצעה נדחית, ואף אחד מהשחקנים לא מקבל כלום – הכסף הולך "לאיבוד".</li>
            </ul>
        </li>
    </ol>
    <p>חשוב: המשחק משוחק בדרך כלל **רק פעם אחת**. זה מונע שיקולים של מוניטין או תגמול בסבבים עתידיים.</p>

    <h3>ההתנגשות: רציונליות מול התנהגות</h3>
    <p>מה הייתה התוצאה אם שני השחקנים היו "רציונליים" לחלוטין ואנוכיים, ושואפים רק למקסם את רווחם הכספי? שחקן 1 היה מציע לשחקן 2 את הסכום הקטן ביותר האפשרי (למשל, שקל אחד), ושחקן 2 היה מקבל כל הצעה שגדולה מאפס. מדוע? כי אפילו שקל אחד טוב יותר מלא כלום.</p>
    <p>אבל, ניסויים שוב ושוב מראים שזו **לא** ההתנהגות האנושית האופיינית. רוב המציעים מציעים סכומים משמעותיים יותר (לרוב בין 40% ל-50%), ורוב המקבלים דוחים הצעות שנחשבות נמוכות מדי או "לא הוגנות" (בדרך כלל הצעות הנמוכות מ-20%-30% נדחות בשיעור גבוה). אנשים מוכנים לשלם מחיר (לוותר על כסף) כדי להעניש התנהגות שהם תופסים כמקפחת או בלתי הוגנת.</p>

    <h3>איך הסימולטור עוזר להבין?</h3>
    <p>הסימולטור הזה מאפשר לכם להגדיר את "סף ההוגנות" המינימלי של המקבל (הסכום הנמוך ביותר, באחוזים, שהמקבל בסימולציה **שלכם** יסכים לקבל). לאחר מכן, הוא מדמה מספר רב של סבבים שבהם שחקן 1 (מיוצג על ידי מחולל הצעות אקראי) מציע חלוקות שונות. אתם רואים בזמן אמת (ובסיכום סופי) כמה הצעות מתקבלות וכמה נדחות, ואיך זה משפיע על סך הכסף שמחולק בפועל.</p>
    <p>זה ממחיש ויזואלית את הרעיון המרכזי: כאשר המקבלים מונעים גם משיקולי הוגנות (ולא רק מרווח כספי טהור), הם יוצרים מנגנון שמאלץ גם מציעים "רציונליים" להציע הצעות נדיבות יותר, פשוט כי אחרת ההצעות שלהם יידחו והם לא יקבלו כלום.</p>

    <h3>השלכות מהעולם האמיתי</h3>
    <p>משחק האולטימטום חושף את כוחן של נורמות חברתיות ורגשות אנושיים בעיצוב החלטות כלכליות וחברתיות. הוא רלוונטי למגוון תחומים:</p>
    <ul>
        <li>**משא ומתן:** הבנת נקודת המבט של הצד השני ומה ייחשב בעיניו כ"הוגן" היא קריטית להצלחה.</li>
        <li>**חלוקת משאבים ציבוריים:** מחאות חברתיות רבות נובעות מתחושה של חוסר הוגנות בחלוקת העושר או המשאבים.</li>
        <li>**שוק העבודה:** משכורות והטבות שאינן נתפסות כהוגנות עלולות להוביל לחוסר שביעות רצון, שביתות, ועזיבת עובדים, גם אם השכר "טכנית" גבוה מספיק לחיים.</li>
        <li>**יחסים בינלאומיים:** הסכמים בין מדינות לעיתים קרובות תלויים בתפיסת ההוגנות של החלוקה או ההסדר.</li>
    </ul>
    <p>המשחק מראה שאנשים הם יצורים חברתיים שמגיבים לא רק לתמריצים כספיים, אלא גם לתפיסות של צדק והוגנות, ומוכנים "להעניש" את מי שפוגע בתפיסות הללו, גם במחיר אישי.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const totalAmountInput = document.getElementById('total-amount');
        const numRoundsInput = document.getElementById('num-rounds');
        const minAcceptanceInput = document.getElementById('min-acceptance');
        const startSimulationButton = document.getElementById('start-simulation');
        const roundsExecutedSpan = document.getElementById('rounds-executed');
        const totalSimRoundsSpan = document.getElementById('total-sim-rounds');
        const acceptedCountSpan = document.getElementById('accepted-count');
        const rejectedCountSpan = document.getElementById('rejected-count');
        const acceptanceRateSpan = document.getElementById('acceptance-rate');
        const totalSharedSpan = document.getElementById('total-shared');
        const resultsChartCanvas = document.getElementById('resultsChart').getContext('2d');
        const toggleExplanationButton = document.getElementById('toggle-explanation-button');
        const explanationContent = document.querySelector('.explanation-content');
        const simulationProgressBar = document.getElementById('simulation-progress');
        const offerBucketsBarContainer = document.querySelector('.offer-buckets-bar-container');


        let simulationChart;
        const offerBucketRanges = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 101]; // Ranges for buckets (0-9, 10-19, ..., 90-100)

        // Initialize Chart
        const createChart = (labels, acceptedData, rejectedData) => {
            if (simulationChart) {
                simulationChart.destroy();
            }
            simulationChart = new Chart(resultsChartCanvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'הצעות שהתקבלו ✅',
                            data: acceptedData,
                            backgroundColor: 'rgba(40, 167, 69, 0.8)', // Greenish
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        },
                        {
                            label: 'הצעות שנדחו ❌',
                            data: rejectedData,
                            backgroundColor: 'rgba(220, 53, 69, 0.8)', // Reddish
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1,
                             borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            rtl: true,
                            callbacks: {
                                title: function(context) {
                                     const label = context[0].label;
                                     // Label is like "0-9". Extract the range.
                                     return `הצעה בטווח: ${label}%`;
                                },
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                         // Remove icons from label for tooltip
                                        label = label.replace(/✅|❌/g, '').trim() + ': ';
                                    }
                                    label += context.raw;
                                    return label;
                                }
                            }
                        },
                        legend: {
                            rtl: true,
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, family: 'Varela Round' }
                            }
                        },
                        title: {
                            display: false, // Title handled by H3 outside canvas
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'מספר הצעות בטווח זה',
                                font: { size: 14, family: 'Varela Round' }
                            },
                             ticks: {
                                precision: 0
                            },
                             grid: {
                                drawOnChartArea: true // Keep grid lines
                             }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'הצעת שחקן 1 למקבל (אחוזים מהסכום)',
                                font: { size: 14, family: 'Varela Round' }
                            },
                             grid: {
                                drawOnChartArea: false // Remove x-axis grid lines
                            }
                        }
                    },
                    animation: {
                        duration: 1200, // Faster animation
                        easing: 'easeOutQuart'
                    }
                }
            });
        };

        // Helper to generate random integer
        const getRandomInt = (min, max) => {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };

         // Function to get the bucket index for a percentage
        const getBucketIndex = (percentage) => {
            for (let i = 0; i < offerBucketRanges.length - 1; i++) {
                if (percentage >= offerBucketRanges[i] && percentage < offerBucketRanges[i + 1]) {
                    return i;
                }
            }
            return offerBucketRanges.length - 1; // Should not happen with 0-101 range
        };

        // Initialize visual buckets
        const initializeVisualBuckets = (numBuckets) => {
            offerBucketsBarContainer.innerHTML = ''; // Clear previous bars
             for (let i = 0; i < numBuckets; i++) {
                 const bucketBar = document.createElement('div');
                 bucketBar.classList.add('offer-bucket-bar');
                 // Set width based on number of buckets
                 bucketBar.style.width = `${100 / numBuckets}%`;
                 bucketBar.dataset.bucketIndex = i; // Store index

                 const acceptedSegment = document.createElement('div');
                 acceptedSegment.classList.add('bucket-segment', 'accepted');
                 acceptedSegment.style.height = '0%';

                 const rejectedSegment = document.createElement('div');
                 rejectedSegment.classList.add('bucket-segment', 'rejected');
                 rejectedSegment.style.height = '0%';

                 bucketBar.appendChild(rejectedSegment); // Rejected below accepted
                 bucketBar.appendChild(acceptedSegment);
                 offerBucketsBarContainer.appendChild(bucketBar);
             }
        };

        // Update visual buckets
        const updateVisualBuckets = (offerBuckets, totalRoundsCompleted) => {
             const buckets = offerBucketsBarContainer.querySelectorAll('.offer-bucket-bar');
             buckets.forEach(bar => {
                 const index = parseInt(bar.dataset.bucketIndex);
                 const bucketData = offerBuckets[index] || { accepted: 0, rejected: 0 };
                 const totalInBucket = bucketData.accepted + bucketData.rejected;

                 const acceptedHeight = totalInBucket > 0 ? (bucketData.accepted / totalRoundsCompleted) * 100 : 0;
                 const rejectedHeight = totalInBucket > 0 ? (bucketData.rejected / totalRoundsCompleted) * 100 : 0;

                 // Ensure total height doesn't exceed 100% based on completed rounds vs total rounds
                 const maxPossibleHeight = (totalInBucket / totalRoundsCompleted) * 100;


                 const acceptedSegment = bar.querySelector('.bucket-segment.accepted');
                 const rejectedSegment = bar.querySelector('.bucket-segment.rejected');

                 // Use heights relative to total rounds completed for visual scale
                 acceptedSegment.style.height = `${(bucketData.accepted / totalRoundsCompleted) * 100}%`;
                 rejectedSegment.style.height = `${(bucketData.rejected / totalRoundsCompleted) * 100}%`;

             });
        };


        startSimulationButton.addEventListener('click', async () => { // Use async to allow await for delay
            const totalAmount = parseInt(totalAmountInput.value);
            const numRounds = parseInt(numRoundsInput.value);
            const minAcceptancePercent = parseInt(minAcceptanceInput.value);
            const minAcceptanceAmount = (minAcceptancePercent / 100) * totalAmount;

            if (isNaN(totalAmount) || totalAmount <= 0) {
                alert('אנא הכנס סכום כסף חוקי וגדול מאפס.');
                return;
            }
            if (isNaN(numRounds) || numRounds < 10) {
                 alert('אנא הכנס מספר סבבי סימולציה חוקי (מינימום 10).');
                 return;
            }
             if (isNaN(minAcceptancePercent) || minAcceptancePercent < 0 || minAcceptancePercent > 100) {
                 alert('אנא הכנס אחוז קבלה מינימלי חוקי (בין 0 ל-100).');
                 return;
            }

            // Disable button and show initial state
            startSimulationButton.disabled = true;
            startSimulationButton.querySelector('span').textContent = 'מריצים סימולציה...';
            startSimulationButton.querySelector('i').innerHTML = '⏳'; // Change icon


            let acceptedCount = 0;
            let rejectedCount = 0;
            let totalShared = 0;

            // Data for chart and visual buckets (grouping offers by percentage)
            // Using array for offerBuckets to map directly to visual buckets by index
             const offerBuckets = Array.from({ length: offerBucketRanges.length - 1 }, () => ({ accepted: 0, rejected: 0 }));
             initializeVisualBuckets(offerBuckets.length); // Create the visual elements

            totalSimRoundsSpan.textContent = numRounds;
            roundsExecutedSpan.textContent = 0;
            acceptedCountSpan.textContent = 0;
            rejectedCountSpan.textContent = 0;
            acceptanceRateSpan.textContent = '0%';
            totalSharedSpan.textContent = 0;
            simulationProgressBar.style.width = '0%';


            // Simulate rounds
            for (let i = 0; i < numRounds; i++) {
                // Player 1 proposes a split (random offer for Player 2)
                // Offer for Player 2 is between 0 and totalAmount
                const offerToPlayer2 = getRandomInt(0, totalAmount);
                const offerPercent = Math.round((offerToPlayer2 / totalAmount) * 100);

                // Player 2 decides (based on minAcceptanceAmount)
                const accepted = offerToPlayer2 >= minAcceptanceAmount;

                // Find the correct bucket index for this offer percentage
                const bucketIndex = getBucketIndex(offerPercent);

                if (accepted) {
                    acceptedCount++;
                    totalShared += totalAmount; // Both get their share if accepted
                    if (offerBuckets[bucketIndex]) offerBuckets[bucketIndex].accepted++;
                } else {
                    rejectedCount++;
                     if (offerBuckets[bucketIndex]) offerBuckets[bucketIndex].rejected++;
                }

                // Update stats and visuals periodically
                 if ((i + 1) % Math.max(1, Math.floor(numRounds / 50)) === 0 || (i + 1) === numRounds) { // Update 50 times during sim
                    roundsExecutedSpan.textContent = i + 1;
                    acceptedCountSpan.textContent = acceptedCount;
                    rejectedCountSpan.textContent = rejectedCount;
                    acceptanceRateSpan.textContent = numRounds > 0 ? ((acceptedCount / (i + 1)) * 100).toFixed(1) + '%' : '0%'; // Calculate based on completed rounds
                    totalSharedSpan.textContent = totalShared;
                    simulationProgressBar.style.width = `${((i + 1) / numRounds) * 100}%`;

                     updateVisualBuckets(offerBuckets, i + 1); // Update visual bars
                 }

                 // Small delay for animation effect if desired, but let's run fast for speed
                 // await new Promise(resolve => setTimeout(resolve, 10)); // Add a small delay if needed

            }

            // Final updates after simulation loop
            roundsExecutedSpan.textContent = numRounds;
            acceptedCountSpan.textContent = acceptedCount;
            rejectedCountSpan.textContent = rejectedCount;
            acceptanceRateSpan.textContent = numRounds > 0 ? ((acceptedCount / numRounds) * 100).toFixed(1) + '%' : '0%';
            totalSharedSpan.textContent = totalShared;
            simulationProgressBar.style.width = '100%';
             updateVisualBuckets(offerBuckets, numRounds); // Final visual bucket update


            // Prepare data for the chart
            const chartLabels = offerBucketRanges.slice(0, -1).map((range, i) => {
                 const start = range;
                 const end = offerBucketRanges[i + 1] - (i === offerBucketRanges.length - 2 ? 1 : 0) -1 ; // Adjust end for last range
                 return `${start}-${end === 99 ? 100 : end}`;
            });

             const acceptedData = offerBuckets.map(bucket => bucket.accepted);
             const rejectedData = offerBuckets.map(bucket => bucket.rejected);


            createChart(chartLabels, acceptedData, rejectedData);

            // Re-enable button and reset text
            startSimulationButton.disabled = false;
            startSimulationButton.querySelector('span').textContent = 'הפעל סימולציה נוספת!';
             startSimulationButton.querySelector('i').innerHTML = '▶️'; // Reset icon

            console.log("Simulation finished");
        });


        // Toggle explanation visibility
        toggleExplanationButton.addEventListener('click', () => {
            const isHidden = explanationContent.style.display === 'none' || explanationContent.style.display === '';
            explanationContent.style.display = isHidden ? 'block' : 'none';
             // Optional: Scroll to explanation if showing
             if (isHidden) {
                 // Small delay to allow display:block to take effect before scrolling
                 setTimeout(() => {
                     explanationContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                 }, 50);
             }
             toggleExplanationButton.textContent = isHidden ? 'הסתר הסבר על המשחק' : 'מה זה בעצם? הסבר על המשחק!';
        });


         // Initial chart creation (empty or example data)
         const initialChartLabels = offerBucketRanges.slice(0, -1).map((range, i) => {
                 const start = range;
                 const end = offerBucketRanges[i + 1] - (i === offerBucketRanges.length - 2 ? 1 : 0) -1 ;
                  return `${start}-${end === 99 ? 100 : end}`;
            });
         createChart(initialChartLabels, [], []); // Create an empty chart initially
         initializeVisualBuckets(offerBucketRanges.length - 1); // Initialize empty visual buckets

    });
</script>
---